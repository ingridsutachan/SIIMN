using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Windows.Forms;
using Negocios.Contable;
using Entities.Types;

namespace App.Forms.Contable
{
    public partial class Form_Formatos : Form
    {

             private string botonclick;

        private formatosn negocioFormato;

        private Cuentan negocioCuenta;

        private bool usrClose;

        private Funciones funtions;

        public Form_Formatos()
        {
            InitializeComponent();
                   this.negocioFormato = new formatosn();
            this.negocioCuenta = new Cuentan();
            this.funtions = new Funciones();
        }

        #region VISUALIZACION

        private void CargarClases()
        {
            try
            {
                /* if (cbx_tipo.Text.Equals("PYG"))
                {
                    cbx_clase.Items.Add("INGRESOS");
                    cbx_clase.Items.Add("GASTOS");
                    cbx_clase.Items.Add("CONTENIDO DE LA UTILIDAD O PERDIDA");
                    cbx_clase.SelectedIndex = 0;
                    cuentas = this.negocioCuenta.CargarCuenta();
                }
                this.AutoCompletar(cuentas);*/

            }
            catch (Exception ex)
            {
                MessageBox.Show("Se presento un error. " + ex.Message);
            }
        }

        private void AutoCompletar(List<CuentaDataSource> cuenta)
        {
            AutoCompleteStringCollection cuentas = new AutoCompleteStringCollection();
            foreach (CuentaDataSource item in cuenta)
            {
                cuentas.Add(item.Cuenta);
                cuentas.Add(item.Nombre);
            }

            txt_cuentaini.AutoCompleteCustomSource = cuentas;
            txt_cuentafin.AutoCompleteCustomSource = cuentas;
        }
        #endregion

        #region   GUARDAR DATOS
       /* private FormatoDataSource GuardarDatos()
        {
            FormatoDataSource format = new FormatoDataSource();
            if (cbx_tipo.SelectedIndex == 0)
            {
                format.TipoFormato = "1";
                format.ClaseCuenta = cbx_clase.SelectedValue.ToString();
            }
            if (cbx_tipo.SelectedIndex == 1)
            {
                format.TipoFormato = "2";
                format.ClaseCuenta = Convert.ToString(int.Parse(cbx_clase.SelectedIndex.ToString()) + 1);
            }
            format.Linea = txt_linea.Text;
            format.Nombre = txt_nombre.Text;
            format.CuentaInicial = txt_cuentaini.Text;
            format.CuentaFinal = txt_cuentafin.Text;
            return format;
        }*/


        private bool ValidarGuardar()
        {
            bool result = false;
            if (!cbx_tipo.Text.Equals(string.Empty) && !txt_encabezado.Text.Equals(string.Empty) && !txt_linea.Text.Equals(string.Empty) && !txt_nombre.Text.Equals(string.Empty) &&
                !txt_cuentaini.Text.Equals(string.Empty) && !txt_cuentafin.Text.Equals(string.Empty))
            {
                result = true;
            }
            else
            {
                result = false;
                MessageBox.Show("Debe ingresar todos los campos", "ERROR", MessageBoxButtons.OK);
            }

            return result;
        }

        private void btn_guardar_Click(object sender, EventArgs e)
        {
            bool validar = this.ValidarGuardar();
            if (validar)
            {
                FormatoDataSource formato = new FormatoDataSource();
               //formato = this.GuardarDatos();

                if (botonclick.Equals("agregar"))
                {
                    bool existe = this.negocioFormato.ExisteFormato(formato);
                    if (!existe)
                    {
                        bool guardo = this.negocioFormato.GuardarFormato(formato, txt_encabezado.Text);
                        if (guardo)
                        {
                            MessageBox.Show("El formato ha sido guardado", "GUARDO", MessageBoxButtons.OK);
                            cbx_tipo.Enabled = false;
                            txt_encabezado.Enabled = false;
                            txt_linea.Text = string.Empty;
                            txt_nombre.Text = string.Empty;
                            txt_cuentafin.Text = string.Empty;
                            txt_cuentaini.Text = string.Empty;
                            btn_editar.Enabled = true;
                        }

                    }
                    else
                    {
                        MessageBox.Show("El formato ya existe", "GUARDO", MessageBoxButtons.OK);
                    }
                }
                else if (botonclick.Equals("editar"))
                {
                    bool guardo = this.negocioFormato.ActualizarFormato(formato, txt_encabezado.Text);
                    if (guardo)
                    {
                        MessageBox.Show("El formato ha sido actualizado", "GUARDO", MessageBoxButtons.OK);
                        cbx_tipo.Enabled = false;
                        txt_encabezado.Enabled = false;
                        txt_linea.Text = string.Empty;
                        txt_nombre.Text = string.Empty;
                        txt_cuentafin.Text = string.Empty;
                        txt_cuentaini.Text = string.Empty;
                        btn_editar.Enabled = true;
                    }
                }
            }
        }
        #endregion

        #region BOTONES CLICK

        private void btn_nuevo_Click(object sender, EventArgs e)
        {
            this.botonclick = "agregar";
                        cbx_tipo.Enabled = true;
            txt_encabezado.Enabled = true;
            txt_linea.Enabled = true;
            txt_nombre.Enabled = true;
            txt_cuentafin.Enabled = true;
            txt_cuentaini.Enabled = true;
            btn_guardar.Enabled = true;
            txt_encabezado.Text = string.Empty;
            txt_linea.Text = string.Empty;
            txt_nombre.Text = string.Empty;
            txt_cuentafin.Text = string.Empty;
            txt_cuentaini.Text = string.Empty;
            btn_guardar.Enabled = true;
        }

        private void btn_editar_Click(object sender, EventArgs e)
        {
            cbx_tipo.Enabled = true;
            txt_encabezado.Enabled = true;
                        txt_linea.Enabled = true;
            txt_encabezado.Text = string.Empty;
            cbx_tipo.Text = string.Empty;
                        txt_linea.Text = string.Empty;
            btn_buscar.Visible = true;
            this.botonclick = "editar";
        }

        #endregion

        private void cbx_clase_SelectedIndexChanged(object sender, EventArgs e)
        {


        }

        private void tabenter_KeyUp(object sender, KeyEventArgs e)
        {
            if (e.KeyValue == (char)Keys.Enter)
            {
                e.Handled = true;
                SendKeys.Send("{TAB}");
            }
        }
        private void cbx_tipo_SelectedIndexChanged(object sender, EventArgs e)
        {
              string tipofor = cbx_tipo.SelectedIndex == 0 ? "1" : "2";
            txt_encabezado.Text = this.negocioFormato.DevolverEncabezado(tipofor);
            this.CargarClases();
        }


        private void txt_linea_KeyPress(object sender, KeyPressEventArgs e)
        {
            if (e.KeyChar == (char)Keys.Enter)
            {
                e.Handled = true;
                SendKeys.Send("{TAB}");
            }
            else
            {
                e.Handled = this.funtions.ValidacionNumerico(e).Handled;
            }
        }


        #region SAlIR FORMULARIO

        private void salircuent_Click(object sender, EventArgs e)
        {
            DialogResult result = MessageBox.Show("Esta seguro que desea salir?", "SALIR", MessageBoxButtons.YesNo);
            if (result == DialogResult.Yes)
            {
                this.usrClose = true;
                this.Close();
            }
        }


        private void frm_formatos_FormClosing(object sender, FormClosingEventArgs e)
        {

            if (!this.usrClose)
            {
                DialogResult result = MessageBox.Show("Esta seguro que desea salir?", "SALIR", MessageBoxButtons.YesNo);
                if (result == DialogResult.No)
                {
                    e.Cancel = true;
                }
            }
        }

        #endregion

                private void btn_buscar_Click(object sender, EventArgs e)
        {
            FormatoDataSource format = new FormatoDataSource();
            format.TipoFormato = cbx_tipo.SelectedIndex.ToString() == "0" ? "1" : "2";
           // format.ClaseCuenta = cbx_tipo.SelectedIndex.ToString() == "0" ? cbx_clase.SelectedValue.ToString() : Convert.ToString(int.Parse(cbx_clase.SelectedIndex.ToString()) + 1);
            format.Linea = txt_linea.Text;
            bool existe = this.negocioFormato.ExisteFormato(format);
            if (existe)
            {
                FormatoDataSource formato = new FormatoDataSource();
                formato = this.negocioFormato.DevolverFormato(format);
                txt_nombre.Enabled = true;
                txt_cuentaini.Enabled = true;
                txt_cuentafin.Enabled = true;
                txt_nombre.Text = formato.Nombre;
                txt_cuentaini.Text = formato.CuentaInicial;
                txt_cuentafin.Text = formato.CuentaFinal;
                btn_guardar.Enabled = true;
                cbx_tipo.Enabled = false;
                //cbx_clase.Enabled = false;
                txt_linea.Enabled = false;
                btn_buscar.Enabled = false;
            }
            else
            {
                MessageBox.Show("El tipo de formato que busca no existe", "NO EXISTE", MessageBoxButtons.OK);
            }
        }




    }
}

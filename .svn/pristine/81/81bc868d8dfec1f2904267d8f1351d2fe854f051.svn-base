using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Windows.Forms;
using Entities.Types;
using Negocios.Contable;
using Negocios.General;
using App.Forms.Contable.Reportes.Types;
using System.Globalization;

namespace App.Forms.Contable.Reportes
{
    public partial class Form_ReportePresupuesto : Form
    {
        private Presupueston negocioPresupuesto;

        private Empresan negocioEmpresa;

        public Form_ReportePresupuesto()
        {
            this.negocioPresupuesto = new Presupueston();
            this.negocioEmpresa = new Empresan();
            this.InitializeComponent();
        }

        private void btn_informe_ButtonClick(object sender, EventArgs e)
        {
            List<PresupDataSource> presupuesto = new List<PresupDataSource>();
            presupuesto = this.negocioPresupuesto.DevolverPresu(txt_anio.Text, txt_cuenta.Text, int.Parse(txt_centro.Text), Program.compa);
            EmpresaDataSource empresa = new EmpresaDataSource();
            empresa = this.negocioEmpresa.DevolverDatosEmpresa(Program.compa);
            List<PresupShowDataSourceReporte> presupR = new List<PresupShowDataSourceReporte>();
            foreach (PresupDataSource item in presupuesto)
            {
                PresupShowDataSourceReporte presupDev = new PresupShowDataSourceReporte();
                presupDev.Anio = item.Anio;
                presupDev.NombreMes = CultureInfo.CurrentCulture.DateTimeFormat.GetMonthName(item.IdMes);
                presupDev.Cuenta = item.Cuenta;
                presupDev.NombreCuenta = item.NombreCentro;
                presupDev.IdCentro = item.IdCentro;
                presupDev.NombreCentro = item.NombreCentro;
                presupDev.Presupuesto = item.Presupuesto;
                presupDev.NombreEmpresa = empresa.Nombrecia;
                presupDev.NombreSucursal = empresa.NombreSucursal;
                presupDev.NitEmpresa = empresa.NitCia;
                presupDev.Digito = empresa.DigitoCia;
                presupDev.Fecha = fecha_informepres.Value.ToShortDateString();
                presupR.Add(presupDev);
            }

            ReportePresupuesto reportpresup = new ReportePresupuesto();
            reportpresup.SetDataSource(presupR);
            crystal_Presupuesto.ReportSource = reportpresup;
            this.Size = new Size(1003, 583);
            crystal_Presupuesto.Size = new Size(987, 519);
            this.crystal_Presupuesto.Visible = true;
            this.lbl_cuenta.Visible = false;
            this.lbl_anio.Visible = false;
            this.txt_anio.Visible = false;
            //this.txt_nombrecuentafin.Visible = false;
           // this.txt_nombrecuentaini.Visible = false;
            txt_cuenta.Visible = false;
            lbl_fecha.Visible = false;
            fecha_informepres.Visible = false;
            this.CenterToScreen();
        }
    }
}

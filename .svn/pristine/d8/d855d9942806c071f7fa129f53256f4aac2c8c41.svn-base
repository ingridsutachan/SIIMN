////*********************************************************
//
//    <copyright file="cuentac.cs" company="Marketing Software de Colombia LTDA">
//    @Autor Ingrid Sutachan
//    @fecha 01 marzo 2014
//    </copyright>
//
////*********************************************************
namespace Datos.Contable
{
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using Entities;

    /// <summary>
    /// Clase cuenta de capa de datos
    /// </summary>
    public class Cuentac
    {
        /// <summary>
        /// Initializes a new instance of the <see cref="Cuentac"/> class.
        /// </summary>
        public Cuentac()
        {
        }

        /// <summary>
        /// Cargar cuenta
        /// </summary>
        /// <returns>lista de las cuentas que se encuentran en la tabla cuenta</returns>
        public List<maeconta> CargarCuenta()
        {
            using (siimnEntities bd = new siimnEntities())
            {
                List<maeconta> cuenta = new List<maeconta>();
                try
                {
                    var query = bd.maeconta.ToList();
                    if (query.Count() > 0)
                        cuenta = query;
                    else
                        cuenta = null;
                }
                catch (Exception ex)
                {
                    throw ex;
                }

                return cuenta;
            }
        }

        /// <summary>
        /// Existe cuenta
        /// </summary>
        /// <param name="id">identificador de cuenta</param>
        /// <returns>booleano que rectifica si la cuenta existe</returns>
        public bool ExisteCuenta(string id)
        {
            using (siimnEntities bd = new siimnEntities())
            {
                bool result = false;
                try
                {
                    var query = bd.maeconta.Where(cue => cue.cuenta == id).Count();
                    result = query == 0 ? false : true;
                }
                catch (Exception ex)
                {
                    throw ex;
                }

                return result;
            }
        }

        /// <summary>
        /// Devuelve datos
        /// </summary>
        /// <param name="id">identificador de la cuenta</param>
        /// <returns>devuelve la cuenta que es respetiva al identificador</returns>
        public maeconta DevuelveDatos(string id)
        {
            using (siimnEntities bd = new siimnEntities())
            {
                maeconta datos = new maeconta();
                try
                {
                    var query = bd.maeconta.Where(cue => cue.cuenta == id).First();
                    datos = query;
                }
                catch (Exception ex)
                {
                    throw ex;
                }

                return datos;
            }
        }

        /// <summary>
        /// Crea  cuenta
        /// </summary>
        /// <param name="cuenta">cuenta a crear</param>
        /// <returns>cuenta que ha sido creada</returns>
        public bool GuardarCuenta(maeconta cuenta)
        {
            bool result = false;
            try
            {
                using (siimnEntities bd = new siimnEntities())
                {
                    maeconta cu = new maeconta();
                    cu.cuenta = cuenta.cuenta;
                    cu.tipocta = cuenta.tipocta;
                    cu.nombre = cuenta.nombre;
                    cu.pidenit = cuenta.pidenit;
                    cu.centro = cuenta.centro;
                    cu.ajustesinteg = cuenta.ajustesinteg;
                    cu.idnitajustes = cuenta.idnitajustes;
                    cu.cueaju = cuenta.cueaju;
                    cu.cuencorre = cuenta.cuencorre;
                    cu.ajudoc = cuenta.ajudoc;
                    cu.retencion = cuenta.retencion;
                    cu.porete = cuenta.porete;
                    cu.conceprete = cuenta.conceprete;
                    cu.reteica = cuenta.reteica;
                    cu.formatomedios = cuenta.formatomedios;
                    bd.maeconta.Add(cu);
                    bd.SaveChanges();
                    result = true;
                }
            }
            catch (Exception ex)
            {
                throw ex;
            }

            return result;
        }

        /// <summary>
        /// Actualiza la cuenta.
        /// </summary>
        /// <param name="cuenta">cuenta a actualizar</param>
        /// <returns>cuenta que ha sido actualizada </returns>
        public bool ActualizarCuenta(maeconta cuenta)
        {
            bool result = false;

            using (siimnEntities bd = new siimnEntities())
            {
                try
                {
                    var query = bd.maeconta.Where(cue => cue.cuenta == cuenta.cuenta).First();
                    query.cuenta = cuenta.cuenta;
                    query.tipocta = cuenta.tipocta;
                    query.nombre = cuenta.nombre;
                    query.pidenit = cuenta.pidenit;
                    query.centro = cuenta.centro;
                    query.ajustesinteg = cuenta.ajustesinteg;
                    query.idnitajustes = cuenta.idnitajustes;
                    query.cueaju = cuenta.cueaju;
                    query.cuencorre = cuenta.cuencorre;
                    query.ajudoc = cuenta.ajudoc;
                    query.retencion = cuenta.retencion;
                    query.porete = cuenta.porete;
                    query.conceprete = cuenta.conceprete;
                    query.reteica = cuenta.reteica;
                    query.formatomedios = cuenta.formatomedios;
                    bd.SaveChanges();
                    result = true;
                }
                catch (Exception ex)
                {
                    throw ex;
                }
            }

            return result;
        }

        /// <summary>
        /// Elimina cuenta
        /// </summary>
        /// <param name="id">identificador de la cuenta</param>
        /// <returns>booleano que rectifica si la cuenta ha sido eliminada</returns>
        public bool EliminarCuenta(string id)
        {
            using (siimnEntities bd = new siimnEntities())
            {
                bool result = false;
                try
                {
                    var query = bd.maeconta.Where(mae => mae.cuenta == id).First();
                    bd.maeconta.Remove(query);
                    bd.SaveChanges();
                    result = true;
                }
                catch (Exception ex)
                {
                    throw ex;
                }

                return result;
            }
        }

        /// <summary>
        /// Busca la cuenta
        /// </summary>
        /// <param name="buscar">texto a buscar en la tabla cuenta</param>
        /// <returns>lista de los registros de la tabla cuenta que contienen la busqueda</returns>
        public List<maeconta> BuscarCuentac(string buscar)
        {
            List<maeconta> result = new List<maeconta>();

            using (siimnEntities bd = new siimnEntities())
            {
                try
                {
                    var query = bd.maeconta.Where(mae => mae.cuenta.Contains(buscar) || mae.nombre.Contains(buscar));
                    result = query.Count() > 0 ? query.ToList() : null;
                }
                catch (Exception ex)
                {
                    throw ex;
                }
            }

            return result;
        }

        /// <summary>
        /// Devuelve datos
        /// </summary>
        /// <param name="id">identificador de la cuenta</param>
        /// <returns>devuelve la cuenta que es respetiva al identificador</returns>
        public maeconta BuscarporNombreoCuenta(string id)
        {
            using (siimnEntities bd = new siimnEntities())
            {
                maeconta datos = new maeconta();
                try
                {
                    var query = bd.maeconta.Where(cue => cue.cuenta == id || cue.nombre == id).First();
                    datos = query;
                }
                catch (Exception ex)
                {
                    throw ex;
                }

                return datos;
            }
        }

        /// <summary>
        /// Verifica si existe una cuenta por nombre o por el numero de cuenta
        /// </summary>
        /// <param name="id">identificador de cuenta , nombre de cuenta</param>
        /// <returns>booleano que rectifica si la cuenta existe</returns>
        public bool VerificaxNombreoCuenta(string id)
        {
            using (siimnEntities bd = new siimnEntities())
            {
                bool result = false;
                try
                {
                    var query = bd.maeconta.Where(cue => cue.cuenta == id || cue.nombre == id).Count();
                    result = query == 0 ? false : true;
                }
                catch (Exception ex)
                {
                    throw ex;
                }

                return result;
            }
        }

        public List<maeconta> CargarCuentaDetalle()
        {
            using (siimnEntities bd = new siimnEntities())
            {
                List<maeconta> cuenta = new List<maeconta>();
                try
                {
                    cuenta = bd.maeconta.Where(mae => mae.tipocta == "A").ToList();
                }
                catch (Exception ex)
                {
                    throw ex;
                }

                return cuenta;
            }
        }

        public string DevolverNombre(string codigo)
        {
            using (siimnEntities bd = new siimnEntities())
            {
                string nombre;
                try
                {
                    var query = bd.maeconta.Where(mae => mae.cuenta == codigo).Count();
                    if (query > 0)
                    {
                        var query1 = bd.maeconta.Where(mae => mae.cuenta == codigo).First();
                        nombre = query1.nombre;
                    }
                    else
                    {
                        nombre = string.Empty;
                    }
                }
                catch (Exception ex)
                {
                    throw ex;
                }

                return nombre;
            }
        }

        public bool ExisteCuentaVal(string cuenta)
        {
            using (siimnEntities bd = new siimnEntities())
            {
                bool result = false;
                try
                {
                    var query = bd.maeconta.Where(cue => cue.cuenta == cuenta).Count();
                    result = query == 0 ? false : true;
                }
                catch (Exception ex)
                {
                    throw ex;
                }

                return result;
            }
        }

        public string DevolverTipoCuenta(string cuenta)
        {
            using (siimnEntities bd = new siimnEntities())
            {
                string tipo;
                try
                {
                    var query = bd.maeconta.Where(mae => mae.cuenta == cuenta).Count();
                    if (query > 0)
                    {
                        var query1 = bd.maeconta.Where(mae => mae.cuenta == cuenta).First();
                        tipo = query1.tipocta;
                    }
                    else
                    {
                        tipo = string.Empty;
                    }
                }
                catch (Exception ex)
                {
                    throw ex;
                }

                return tipo;
            }
        }

        public bool ExisteBuscar(string buscar)
        {
            bool existe = false;
            using (siimnEntities bd = new siimnEntities())
            {
                var query = bd.maeconta.Where(mae => mae.cuenta.Contains(buscar) || mae.nombre.Contains(buscar)).Count();
                existe = query > 0 ? true : false;
            }

            return existe;
        }

        public List<maeconta> Busqueda(string tipo, string buscar)
        {
            List<maeconta> cuentabus = new List<maeconta>();
            using (siimnEntities bd = new siimnEntities())
            {
                try
                {
                    if (tipo.Equals("numero cuenta"))
                    {
                        var query = bd.maeconta.Where(ved => ved.cuenta.Contains(buscar)).ToList();
                        cuentabus = query;
                    }
                    if (tipo.Equals("nombre"))
                    {
                        var query = bd.maeconta.Where(ved => ved.nombre.Contains(buscar)).ToList();
                        cuentabus = query;
                    }
                    if (tipo.Equals("tipo cuenta"))
                    {
                        var query = bd.maeconta.Where(ved => ved.tipocta.Contains(buscar)).ToList();
                        cuentabus = query;
                    }
                    if (tipo.Equals("busqueda"))
                    {
                        var query = bd.maeconta.Where(ved => ved.cuenta.Contains(buscar) || ved.nombre.Contains(buscar) || ved.tipocta.Contains(buscar)).ToList();
                        cuentabus = query;
                    }
                    if (tipo.Equals("todos"))
                    {
                        cuentabus = bd.maeconta.ToList();
                    }
                }
                catch (Exception ex)
                {
                    throw ex;
                }
            }

            return cuentabus;
        }

        public bool ValidarCuentaEliminar(string codig)
        {
            bool val = false;
            using (siimnEntities bd = new siimnEntities())
            {
                try
                {
                    var query = bd.maeconta.Where(mae => mae.cuenta.Contains(codig)).Count();
                    if (query > 1)
                        val = false;
                    else
                        val = true;
                }
                catch (Exception ex)
                {
                    throw ex;
                }
            }

            return val;
        }

        public List<maeconta> CargarInforme(string cuentainicial, string cuentafinal)
        {
            List<maeconta> informe = new List<maeconta>();
            using (siimnEntities bd = new siimnEntities())
            {
                try
                {
                    if (cuentainicial.Equals("**"))
                    {
                        var query = bd.maeconta.ToList();
                        if (query.Count() > 0)
                            informe = query;
                    }
                   /* else
                    {
                        var query = bd.maeconta.Where(mae => mae.cuenta >= cuentainicial && mae.cuenta <= cuentafinal).ToList();
                        if (query.Count() > 0)
                            informe = query;
                    }*/
                }
                catch (Exception ex)
                {
                    throw ex;
                }
            }

            return informe;
        }

        public string DevuelveTipo(string cuenta)
        {
            string tipo;
            using (siimnEntities bd = new siimnEntities())
            {
                try
                {
                    var query = bd.maeconta.Where(mae => mae.cuenta == cuenta).First();
                    tipo = query.tipocta;
                }
                catch(Exception ex)
                {
                    throw ex;
                }
            }

            return tipo;
        }
    }
}
